@startuml
title 标准摄像头用户参与会议流程图

|用户|
start
:加入包含Kinect用户的会议;

|客户端应用|
:检测到无Kinect设备;
:初始化标准会议界面;

|摄像头管理|
:枚举可用摄像头设备;
:尝试多种视频约束配置;
if (获取摄像头成功?) then (成功)
  :配置最佳分辨率和帧率;
else (失败)
  :启用备用模拟视频;
  :显示错误信息;
endif
:创建视频处理画布;
:启动视频帧循环;

|WebRTC连接|
:获取标准摄像头媒体流;
:设置本地视频轨道;
:建立与远程Kinect用户的连接;

|信令服务器|
:通知存在Kinect用户;
:转发连接信息;

|WebRTC连接|
:接收Kinect用户的信令;
:创建专用数据通道;
:准备接收点云数据;

|客户端应用|
:创建远程视频显示容器;
:准备点云渲染组件;
:监听视图模式变更;

|WebRTC连接|
if (接收的数据类型) then (视频流)
  :处理远程视频流;
  :添加到远程视频元素;
else (点云数据)
  :解码点云数据包;
  :传递给ThreeJS渲染器;
endif

|摄像头管理|
:检查WebGL支持;
:初始化兼容的点云查看器;
:配置点云渲染参数;

|客户端应用|
:根据远程发送的模式切换显示;
:提供点云交互控制;
:显示连接质量信息;

|用户|
:查看Kinect用户的视频/点云;
:调整音量和视图角度;
:正常参与会议;
stop
@enduml