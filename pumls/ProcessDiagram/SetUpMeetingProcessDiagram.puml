@startuml
title 会议建立和基础连接流程图

|用户|
start
:输入房间ID、用户名和服务器地址;
:点击"加入房间"按钮;

|客户端应用|
:初始化会议系统;
:验证输入参数;
:创建WebRTC管理器;

|信令服务器|
:接收连接请求;
:验证连接参数;
:创建/加入房间;
:回送房间状态信息;

|客户端应用|
:显示房间信息;
:通知当前房间已有用户;

|WebRTC连接|
:初始化对等连接;
:创建本地媒体约束;

|摄像头管理|
:检测可用视频设备;
if (检测到摄像头类型) then (Kinect)
  :初始化Kinect摄像头组件;
else (标准摄像头)
  :初始化标准摄像头组件;
endif
:获取本地媒体流;
:返回媒体流到WebRTC管理器;

|WebRTC连接|
:设置本地媒体流;
:创建数据通道;
if (是新加入用户) then (是)
  :创建offer;
  :设置本地描述;
else (否)
  :等待远程offer;
endif

|信令服务器|
:转发WebRTC信令消息;
:通知所有用户新用户加入;

|WebRTC连接|
:处理ICE候选;
:建立对等连接;
:完成媒体连接;

|客户端应用|
:更新UI显示连接状态;
:启用音视频控制;

|用户|
:看到远程用户视频窗口;
:开始会议交流;
stop
@enduml